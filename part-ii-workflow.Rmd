---
title: "EPINOR Annual Meeting 2021"
subtitle: "A Gentle Introduction to Bayesian Statistics"
author: "Øystein Sørensen"
institute: "Department of Psychology, University of Oslo"
date: "2021/11/02"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r, echo=FALSE}
knitr::opts_chunk$set(fig.align = "center")
```

```{r, echo=FALSE, message=FALSE}
library(tidyverse)
```


---

class: inverse, middle, center

# Part II - Bayesian Workflow for Data Analysis

```{r, message=FALSE, echo=FALSE}
library(tidyverse)
theme_set(theme_classic())
```

---

# Bayesian Workflow?

Gelman et al. (2021) write

> Using Bayesian inference to solve real-world problems requires not only statistical skills, subject matter knowledge, and programming, but also awareness of the decisions made in the process of data analysis. All of these aspects can be understood as part of a tangled workflow of applied Bayesian statistics.

.footnote[Gelman, A., Vehtari, A., Simpson, D., Margossian, C. C., Carpenter, B., Yao, Y., Kennedy, L., Gabry, J., Bürkner, P.-C., & Modrák, M. (2020). Bayesian Workflow. ArXiv:2011.01808 [Stat]. http://arxiv.org/abs/2011.01808]


---

# Phases of a Statistical Workflow

(a) Exploratory data analysis to aid in choosing initial model.

(b) Quantify prior knowledge.

(c) Check that the computations work correctly.

(d) Check that the model fits the data well.

(e) Compare to other more or less complicated models.

.footnote[Gabry, J., Simpson, D., Vehtari, A., Betancourt, M., & Gelman, A. (2019). Visualization in Bayesian workflow. Journal of the Royal Statistical Society: Series A (Statistics in Society), 182(2), 389–402. https://doi.org/10.1111/rssa.12378]


---

# Birth Weight Data

Data from Low Birth Weight Study, used by Hosmer and Lemeshow (2000).


```{r}
dat <- readRDS("data/bwt.rds")
head(dat)
```



.footnote[David W. Hosmer and Stanley Lemeshow (2000). Applied Logistic Regression, Second Edition. John Wiley & Sons, Inc. ISBN:9780471356325. https://doi.org/10.1002/0471722146]


---

# Birth Weight Data

```{r}
head(dat)
```

- **Low**: Did the child have birth weight below 2500 grams?
- **Age**: Age of mother.
- **LWT**: Weight of mother at last menstrual period (kg).
- **Smoker**: Does mother smoke?
- **Hypertension**: Does mother have high blood pressure?

---

# Birth Weight Data

Research question:

- Is weight of mother at last menstrual period related to whether the child has birth weight below 2500 grams?

Possible confounding factors are age, smoking status, and hypertension.

---

# (a) Exploratory data analysis

Women with lower weight have higher probabilty of low birthweight.

```{r, dev='svg', fig.align='center', fig.height=3, fig.width=5, echo=FALSE}
ggplot(dat, aes(x = Low, y = LWT, fill = Low)) + 
  geom_violin() + 
  coord_flip() + 
  theme(legend.position = "none")
```


---

# (a) Exploratory data analysis

.pull-left[
Weaker relationship when stratifying by smoking status?

```{r, dev='svg', fig.align='center', fig.height=3, fig.width=5, echo=FALSE}
ggplot(dat, aes(x = Low, y = LWT, fill = Low)) + 
  geom_violin() + 
  coord_flip() + 
  theme(legend.position = "none") + 
  facet_wrap(vars(Smoker), labeller = as_labeller(function(x) paste("Smoker:", x)))
```
]
--
.pull-right[

Reasonable numbers in each group:

```{r}
dat %>% 
  group_by(Low, Smoker) %>% 
  count()
```

]

---

# (a) Exploratory data analysis


.pull-left[
What about hypertension?

```{r, dev='svg', fig.align='center', fig.height=3, fig.width=5, echo=FALSE}
ggplot(dat, aes(x = Low, y = LWT, fill = Low)) + 
  geom_violin() + 
  coord_flip() + 
  theme(legend.position = "none") + 
  facet_wrap(vars(Hypertension), labeller = as_labeller(function(x) paste("Hypertension:", x)))
```
]
--
.pull-right[

Small group sizes, so we should take the plots with a grain of salt.

```{r}
dat %>% 
  group_by(Low, Hypertension) %>% 
  count()
```

]

---

# (a) Exploratory data analysis

Hard to claim that there is a relationship between age and low birthweight:

```{r, dev='svg', fig.align='center', fig.height=3, fig.width=5, echo=FALSE}
ggplot(dat, aes(x = Low, y = Age, fill = Low)) + 
  geom_violin() + 
  coord_flip() + 
  theme(legend.position = "none")
```

---

# (a) Exploratory data analysis

Logistic regression model seems appropriate.

- Initial model of the form 

`Low ~ LWT`

- We believe that smoking status might be an important covariate to include.

- Will also include age, so the most complex model becomes:

`Low ~ LWT + Age + Smoker`.


---

# (b) Quantify prior knowledge

Prior predictive simulations:

- Giving values to the parameters of the prior distribution is hard. We can circumvent the problem by rather looking at what type of data are implied by the prior.


---

# (b) Quantify prior knowledge

Consider simplest logistic regression model

$$P(Low) = \text{logit}\left(\beta_{0} + \beta_{LWT} LWT\right)$$

Sample parameters from the prior and then sample data given the parameters.


---

class: center, middle

# Thanks!

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).

The chakra comes from [remark.js](https://remarkjs.com), [**knitr**](https://yihui.org/knitr/), and [R Markdown](https://rmarkdown.rstudio.com).
